{"remainingRequest":"/home/andrei/dev/vue/crmav100/node_modules/thread-loader/dist/cjs.js!/home/andrei/dev/vue/crmav100/node_modules/babel-loader/lib/index.js!/home/andrei/dev/vue/crmav100/node_modules/eslint-loader/index.js??ref--13-0!/home/andrei/dev/vue/crmav100/src/store/modules/auth.js","dependencies":[{"path":"/home/andrei/dev/vue/crmav100/src/store/modules/auth.js","mtime":1544390798393},{"path":"/home/andrei/dev/vue/crmav100/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/andrei/dev/vue/crmav100/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/andrei/dev/vue/crmav100/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/andrei/dev/vue/crmav100/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _JSON$stringify from \"/home/andrei/dev/vue/crmav100/node_modules/@babel/runtime-corejs2/core-js/json/stringify\";\nimport _Promise from \"/home/andrei/dev/vue/crmav100/node_modules/@babel/runtime-corejs2/core-js/promise\";\nimport axios from 'axios';\nimport api from '@/config/api';\nvar state = {\n  token: localStorage.getItem('user-token') || '',\n  profile: localStorage.getItem('user-profile') || '',\n  status: '',\n  error: ''\n};\nvar getters = {\n  isAuthenticated: function isAuthenticated(state) {\n    return !!state.token;\n  },\n  profile: function profile(state) {\n    return JSON.parse(state.profile);\n  },\n  role: function role(state) {\n    return state.profile ? JSON.parse(state.profile).role : 0;\n  },\n  status: function status(state) {\n    return state.status;\n  },\n  error: function error(state) {\n    return state.error;\n  }\n};\nvar actions = {\n  login: function login(_ref, user) {\n    var commit = _ref.commit,\n        dispatch = _ref.dispatch;\n    return new _Promise(function (resolve, reject) {\n      commit('authLoading');\n      axios({\n        url: api.token_login,\n        data: user,\n        method: 'POST'\n      }).then(function (resp) {\n        if (resp.data.status == 'ok') {\n          commit('authSuccess', resp.data.token);\n          commit('updateProfile', resp.data.profile);\n        } else {\n          commit('authError', resp.data.error);\n        }\n\n        resolve(resp);\n      });\n    });\n  },\n  logout: function logout(_ref2) {\n    var commit = _ref2.commit,\n        dispatch = _ref2.dispatch;\n    commit('authLogout');\n  }\n};\nvar mutations = {\n  authLoading: function authLoading(state) {\n    state.status = 'loading';\n  },\n  authSuccess: function authSuccess(state, token) {\n    state.status = 'success';\n    state.token = token;\n    localStorage.setItem('user-token', token);\n    axios.defaults.headers.common['Authorization'] = token;\n  },\n  authError: function authError(state, error) {\n    state.status = 'error';\n    state.error = error;\n    localStorage.removeItem('user-token');\n  },\n  authLogout: function authLogout(state) {\n    state.token = '';\n    localStorage.removeItem('user-token');\n    localStorage.removeItem('user-profile');\n    delete axios.defaults.headers.common['Authorization'];\n  },\n  updateProfile: function updateProfile(state, data) {\n    state.profile = _JSON$stringify(data);\n    localStorage.setItem('user-profile', _JSON$stringify(data));\n  },\n  updateStore: function updateStore(state, val) {\n    var p = JSON.parse(state.profile);\n    p.store = val;\n    state.profile = _JSON$stringify(p);\n    localStorage.setItem('user-profile', state.profile);\n  }\n};\nexport default {\n  namespaced: true,\n  state: state,\n  getters: getters,\n  actions: actions,\n  mutations: mutations\n};",{"version":3,"sources":["/home/andrei/dev/vue/crmav100/src/store/modules/auth.js"],"names":["axios","api","state","token","localStorage","getItem","profile","status","error","getters","isAuthenticated","JSON","parse","role","actions","login","user","commit","dispatch","resolve","reject","url","token_login","data","method","then","resp","logout","mutations","authLoading","authSuccess","setItem","defaults","headers","common","authError","removeItem","authLogout","updateProfile","updateStore","val","p","store","namespaced"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport api from '@/config/api'\n\nconst state = {\n  token: localStorage.getItem('user-token') || '',\n  profile: localStorage.getItem('user-profile') || '',\n  status: '',\n  error: '',\n}\n\nconst getters = {\n  isAuthenticated: state => !!state.token,\n  profile: state => JSON.parse(state.profile),\n  role: state => state.profile ? JSON.parse(state.profile).role : 0,\n  status: state => state.status,\n  error: state => state.error,\n}\n\nconst actions = {\n  login: ({commit, dispatch}, user) => {\n    return new Promise((resolve, reject) => {\n      commit('authLoading')\n      axios({url: api.token_login, data: user, method: 'POST' })\n        .then(resp => {\n          if (resp.data.status == 'ok') {\n            commit('authSuccess', resp.data.token)\n            commit('updateProfile', resp.data.profile)\n          } else {\n            commit('authError', resp.data.error)\n          }\n          resolve(resp)\n        })\n      })\n  },\n  logout: ({commit, dispatch}) => {\n        commit('authLogout')\n    }\n}\n\nconst mutations = {\n  authLoading: (state) => {\n    state.status = 'loading'\n  },\n  authSuccess: (state, token) => {\n    state.status = 'success'\n    state.token = token\n    localStorage.setItem('user-token',token)\n    axios.defaults.headers.common['Authorization'] = token\n  },\n  authError: (state, error) => {\n    state.status = 'error'\n    state.error = error\n    localStorage.removeItem('user-token')\n  },\n  authLogout: (state) => {\n    state.token = ''\n    localStorage.removeItem('user-token')\n    localStorage.removeItem('user-profile')\n    delete axios.defaults.headers.common['Authorization']\n  },\n  updateProfile: (state, data) => {\n    state.profile = JSON.stringify(data)\n    localStorage.setItem('user-profile', JSON.stringify(data))\n  },\n  updateStore: (state, val) => {\n    var p = JSON.parse(state.profile)\n    p.store = val\n    state.profile = JSON.stringify(p)\n    localStorage.setItem('user-profile', state.profile)\n  }\n}\n\nexport default {\n  namespaced: true,\n  state,\n  getters,\n  actions,\n  mutations\n}\n"]}]}