(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6bb9705c"],{"21e0":function(t,e,n){"use strict";var s=n("5f9e"),i=n.n(s);i.a},"27bb":function(t,e,n){"use strict";var s=n("be7a"),i=n.n(s);i.a},"2a17":function(t,e,n){},"3fec":function(t,e,n){"use strict";var s=n("2a17"),i=n.n(s);i.a},4589:function(t,e,n){},"5d6b":function(t,e,n){var s=n("e53d").parseInt,i=n("a1ce").trim,a=n("e692"),o=/^[-+]?0[xX]/;t.exports=8!==s(a+"08")||22!==s(a+"0x16")?function(t,e){var n=i(String(t),3);return s(n,e>>>0||(o.test(n)?16:10))}:s},"5f9e":function(t,e,n){},"6a34":function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("header-block"),n("div",{staticClass:"content",class:t.$root.showMenu?"menu-active":""},[n("div",{staticClass:"left-side"},[n("menu-block")],1),n("div",{staticClass:"right-side panel-primary"},[n("router-view")],1),n("div",{staticClass:"content-block"})]),n("v-info")],1)},i=[],a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("nav",{staticClass:"navbar navbar-dark bg-primary fixed-top"},[n("div",[n("button",{staticClass:"btn-blank",on:{click:function(e){t.$root.showMenu=!t.$root.showMenu}}},[n("i",{staticClass:"fas fa-bars"})]),n("div",{staticClass:"menu-title d-none d-sm-inline-block"},[n("router-link",{attrs:{to:{name:"index"}}},[t._v(t._s(t.$root.appName))])],1)]),t.$store.getters["auth/profile"].sip_use?n("div",{staticClass:"phone-block"},[n("phone-form",{attrs:{server:t.$store.getters["auth/profile"].sip_server,user:t.$store.getters["auth/profile"].sip_user,password:t.$store.getters["auth/profile"].sip_password,ws:t.$store.getters["auth/profile"].sip_ws}})],1):t._e(),n("div",{staticClass:"user-info d-none d-sm-block"},[n("span",[t._v(t._s(t.$store.getters["auth/profile"].name))]),n("button",{staticClass:"btn-blank",attrs:{title:"Профиль"},on:{click:function(e){t.showUserModal=!0}}},[n("i",{staticClass:"far fa-user"})]),t.showUserModal?n("user-modal",{on:{close:function(e){t.showUserModal=!1}}}):t._e(),n("button",{staticClass:"btn-blank",on:{click:t.$root.logout}},[n("i",{staticClass:"fas fa-sign-out-alt",attrs:{title:"Выйти"}})])],1)]),n("transition",{attrs:{name:"fade"}},[t.$root.info.visible?n("div",{staticClass:"info-message"},[t._v(t._s(t.$root.info.text))]):t._e()])],1)},o=[],r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"modal"}},[n("div",{staticClass:"user-modal"},[n("div",{staticClass:"modal-header"},[n("div",{on:{click:function(e){return t.$emit("close")}}},[n("router-link",{staticClass:"btn-blank",attrs:{to:{name:"profile"}}},[n("i",{staticClass:"fas fa-cog",attrs:{title:"Профиль"}})])],1),n("div",[n("button",{staticClass:"btn-blank",attrs:{title:"Закрыть"},on:{click:function(e){return t.$emit("close")}}},[n("i",{staticClass:"fas fa-times"})])])]),n("div",{staticClass:"modal-body",on:{click:function(e){return t.$emit("close")}}},[n("div",{staticClass:"text-center"},[n("img",{staticClass:"full-rounded",staticStyle:{width:"100px"},attrs:{src:"/img/icon-user-default.png"}}),n("div",{staticStyle:{"padding-top":"20px"}},[n("p",[n("b",[t._v(t._s(t.$store.getters["auth/profile"].login))]),n("br"),n("b",[t._v("ID: "+t._s(t.$store.getters["auth/profile"].id))]),n("br"),n("b",[t._v(t._s(t.$store.getters["auth/profile"].surname)+" "+t._s(t.$store.getters["user/profile"].name))])])])])])])])},l=[],c=n("2877"),u={},f=Object(c["a"])(u,r,l,!1,null,null,null),d=f.exports,m=(n("bc3a"),n("a3be"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{}},[n("div",{staticClass:"phone"},[n("div",{staticClass:"phone-el"},[t._v(t._s(t.status))]),n("div",{staticClass:"phone-el"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.$root.phone_number,expression:"$root.phone_number"}],staticClass:"form-control form-phone",staticStyle:{width:"190px"},attrs:{type:"text"},domProps:{value:t.$root.phone_number},on:{input:function(e){e.target.composing||t.$set(t.$root,"phone_number",e.target.value)}}})]),n("div",{staticClass:"phone-el"},[n("button",{staticClass:"btn btn-default call-btn call-btn-i",attrs:{title:t.canRing?"Выключить звонок":"Включить звонок"},on:{click:function(e){t.canRing=!t.canRing}}},[n("i",{staticClass:"fa",class:t.canRing?"fa-bell":"fa-bell-slash"})]),n("button",{staticClass:"btn btn-default call-btn call-btn-i",attrs:{disabled:!t.session,title:t.muted?"Включить звук":"Выключить звук"},on:{click:function(e){t.muted=!t.muted}}},[n("i",{staticClass:"fa",class:t.muted?"fa-microphone-slash":"fa-microphone"})]),t.canCall?n("button",{staticClass:"btn btn-default call-btn call-btn-start",attrs:{title:"Позвонить"},on:{click:function(e){return t.startCall()}}},[n("i",{staticClass:"fas fa-phone"})]):n("button",{staticClass:"btn btn-default call-btn call-btn-stop",attrs:{title:"Положить трубку"},on:{click:function(e){return t.endCall()}}},[n("i",{staticClass:"fas fa-phone"})])])]),n("audio",{attrs:{id:"audio_remote",autoplay:"autoplay"}}),n("audio",{attrs:{id:"sip-ringtone",loop:"",src:"/sounds/ringtone.mp3"}})])}),p=[],h={props:{server:String,password:String,user:String,ws:String},data:function(){return{status:"",muted:!1,ua:null,uri:null,canCall:!0,canRing:!0,session:null,sipCallTimer:null,sipRingTone:null,options:null}},created:function(){var t=this;this.$root.$on("global-call",function(){t.startCall()}),this.sipRingTone=document.getElementById("sip-ringtone"),this.uri="sip:"+this.user+"@"+this.server;var e=this,n=new JsSIP.WebSocketInterface(this.ws);n.via_transport="wss";var s={session_timers:!1,use_preloaded_route:!1,sockets:[n],uri:this.uri,password:this.password,realm:this.server},i={progress:function(e){t.status="Соединяем"},failed:function(e){t.endCall()},ended:function(e){t.endCall()},confirmed:function(e){t.startTimer()},muted:function(e){t.muted=!0},unmuted:function(e){t.muted=!1}},a={rtcpMuxPolicy:"negotiate",iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302"]}]};this.options={eventHandlers:i,pcConfig:a,mediaConstraints:{audio:!0,video:!1},rtcOfferConstraints:{offerToReceiveAudio:1}},this.ua=new JsSIP.UA(s),this.ua.on("connected",function(e){t.status="Готов"}),this.ua.on("disconnected",function(e){t.status="Нет соединения"}),this.ua.on("registered",function(t){}),this.ua.on("unregistered",function(e){t.status="Не зарегистрирован"}),this.ua.on("registrationFailed",function(e){t.status="Ошибка регистрации"}),this.ua.on("newRTCSession",function(t){if("local"!==t.originator)e.canCall&&e.canRing||t.session.terminate(e.options);else{var n=t.session.connection;n.addEventListener("addstream",function(t){document.getElementById("audio_remote").srcObject=t.stream})}}),this.ua.start()},watch:{muted:function(){this.muted?this.session.mute():this.session.unmute()}},methods:{n:function(t){return t>9?""+t:"0"+t},endCall:function(){this.canCall=!0,clearInterval(this.sipCallTimer),this.ua.terminateSessions(),this.session=null,this.status="Готов"},startTimer:function(){var t=this;this.status="Разговор 00:00";var e=(new Date).getTime();clearInterval(this.sipCallTimer),this.sipCallTimer=setInterval(function(){var n=(new Date).getTime(),s=n-e,i=Math.floor(s%36e5/6e4),a=Math.floor(s%6e4/1e3);t.status="Разговор "+t.n(i)+":"+t.n(a)},1e3)},startRingTone:function(){try{this.sipRingTone.play()}catch(t){}},stopRingTone:function(){try{this.sipRingTone.pause()}catch(t){}},startCall:function(){if(this.$root.phone_number>0){var t="sip:"+this.$root.phone_number+"@"+this.server;this.session=this.ua.call(t,this.options),this.canCall=!1}}}},b=h,v=(n("21e0"),Object(c["a"])(b,m,p,!1,null,null,null)),g=v.exports,C={name:"mainheader",data:function(){return{showUserModal:!1,search:null}},components:{UserModal:d,phoneForm:g}},_=C,$=(n("cf25"),Object(c["a"])(_,a,o,!1,null,null,null)),k=$.exports,w=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"left-menu-item",staticStyle:{padding:"5px"}},[n("router-link",{attrs:{to:"/profile"}},[n("img",{staticClass:"full-rounded",staticStyle:{width:"100%"},attrs:{src:"/img/icon-user-default.png"}})])],1),n("hr"),n("div",{staticClass:"left-menu"},[t._l(t.$root.mainMenu.data,function(t,e){return n("MenuItem",{key:e,staticClass:"left-menu-item",attrs:{element:t}})}),n("div",{staticClass:"left-menu-item"},[n("button",{staticClass:"btn-blank",on:{click:t.$root.logout}},[n("i",{staticClass:"fas fa-sign-out-alt",attrs:{title:"Выйти"}})])])],2)])},x=[],y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.element.auth.indexOf(parseInt(t.$store.getters["auth/profile"].role))>=0?n("div",[n("router-link",{attrs:{to:t.element.route,title:t.element.title}},[n("i",{staticClass:"fas",class:t.element.icon})])],1):t._e()},S=[],R={props:{element:Object}},T=R,I=Object(c["a"])(T,y,S,!1,null,null,null),M=I.exports,O={components:{MenuItem:M}},E=O,j=(n("3fec"),Object(c["a"])(E,w,x,!1,null,null,null)),U=j.exports,F=n("a74e"),P=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"info-block"},t._l(t.info,function(e,s){return n("transition",{key:s,attrs:{name:"fade"}},[n("div",{staticClass:"info-wrapper"},[n("div",{staticClass:"info-body",class:e.class},[t._v("\n                "+t._s(e.text)+"\n            ")])])])}),1)},J=[],D={data:function(){return{info:[]}},created:function(){var t=this;this.$root.$on("show-info",function(e){t.info.push(e),setTimeout(function(){t.info.splice(t.info.indexOf(e),1)},2e3)})}},A=D,B=(n("27bb"),Object(c["a"])(A,P,J,!1,null,null,null)),N=B.exports,G={mixins:[F["a"]],components:{"menu-block":U,"header-block":k,"v-info":N}},H=G,L=(n("87dd"),Object(c["a"])(H,s,i,!1,null,null,null));e["default"]=L.exports},7445:function(t,e,n){var s=n("63b6"),i=n("5d6b");s(s.G+s.F*(parseInt!=i),{parseInt:i})},"7f7f":function(t,e,n){var s=n("86cc").f,i=Function.prototype,a=/^\s*function ([^ (]*)/,o="name";o in i||n("9e1e")&&s(i,o,{configurable:!0,get:function(){try{return(""+this).match(a)[1]}catch(t){return""}}})},"87dd":function(t,e,n){"use strict";var s=n("4589"),i=n.n(s);i.a},a1ce:function(t,e,n){var s=n("63b6"),i=n("25eb"),a=n("294c"),o=n("e692"),r="["+o+"]",l="​",c=RegExp("^"+r+r+"*"),u=RegExp(r+r+"*$"),f=function(t,e,n){var i={},r=a(function(){return!!o[t]()||l[t]()!=l}),c=i[t]=r?e(d):o[t];n&&(i[n]=c),s(s.P+s.F*r,"String",i)},d=f.trim=function(t,e){return t=String(i(t)),1&e&&(t=t.replace(c,"")),2&e&&(t=t.replace(u,"")),t};t.exports=f},a5ec:function(t,e,n){},a74e:function(t,e,n){"use strict";var s=n("e814"),i=n.n(s),a=(n("7f7f"),n("d665")),o=n("4360");e["a"]={beforeRouteEnter:function(t,e,n){-1!=t.meta.auth.indexOf("*")?(document.title=t.meta.title,n()):"login"!=t.name&&-1==t.meta.auth.indexOf(i()(o["a"].getters["auth/role"]))?(a["a"].push({name:"login"}),n(!1)):(document.title=t.meta.title,n())}}},b9e9:function(t,e,n){n("7445"),t.exports=n("584a").parseInt},be7a:function(t,e,n){},cf25:function(t,e,n){"use strict";var s=n("a5ec"),i=n.n(s);i.a},e692:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},e814:function(t,e,n){t.exports=n("b9e9")}}]);
//# sourceMappingURL=chunk-6bb9705c.9f077886.js.map